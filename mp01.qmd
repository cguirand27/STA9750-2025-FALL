---
title: "Mini Project #01: Netflix Top 10 Analysis"
author: "Caroline Guirand"
---

<!-- Hello and thank you for taking the time to review my assignment! This is the first of a series of four mini projects for my class, Stats 9750: Software Tools for Data Analytics.
-->

# Introduction:

What makes a Netflix original so successful?  As a data analyst supporting the Public Relations team, I'm taking a leap into Netflix's Top 10 data to find out which recent releases have captured audiences worldwide. Together, we'll be exploring the numbers behind Netflix's latest hits and discovering what stories are worth celebrating.

## Data Acquisition
The data set used in this analysis is from Netflix's Tudum Top 10 website.

```{r}

## Data Download
if(!dir.exists(file.path("data", "mp01"))){
    dir.create(file.path("data", "mp01"), showWarnings=FALSE, recursive=TRUE)
}

GLOBAL_TOP_10_FILENAME <- file.path("data", "mp01", "global_top10_alltime.csv")

if(!file.exists(GLOBAL_TOP_10_FILENAME)){
    download.file("https://www.netflix.com/tudum/top10/data/all-weeks-global.tsv", 
                  destfile=GLOBAL_TOP_10_FILENAME)
}

COUNTRY_TOP_10_FILENAME <- file.path("data", "mp01", "country_top10_alltime.csv")

if(!file.exists(COUNTRY_TOP_10_FILENAME)){
    download.file("https://www.netflix.com/tudum/top10/data/all-weeks-countries.tsv", 
                  destfile=COUNTRY_TOP_10_FILENAME)
}

``` 

Data was successfully downloaded and saved.


## Data Import and Preparation
Now that the data is downloaded, we can load it into R and prepare it for analysis. We will be using the `str()` and `glimpse()` functions to examine its structure.

```{r}

# load required packages
if(!require("tidyverse")) install.packages("tidyverse")
library(readr)
library(dplyr)

# Read the Global Top 10 data
GLOBAL_TOP_10 <- read_tsv(GLOBAL_TOP_10_FILENAME)

```
```{r}

str(GLOBAL_TOP_10)

```

```{r}

glimpse(GLOBAL_TOP_10)

```

From these two functions, we can now see that in line 5, season_title is missing. Our next block of code will fix this issue. We will be converting the text string "N/A" to actual missing values:

```{r}

GLOBAL_TOP_10 <- GLOBAL_TOP_10 |>
    mutate(season_title = if_else(season_title == "N/A", NA, season_title))

```

Now to check if it worked:

```{r}

glimpse(GLOBAL_TOP_10)

```
Great, so now the season_title column now shows NA values instead of "N/A" text strings.

**Importing the Country-Level Data**

Now, we'll be importing the country-level data as well, but this time, we'll deal with the "N/A" issue during the import process. We'll be using the 'na' argument in the `read_tsv()` function.

```{r}

COUNTRY_TOP_10 <- read_tsv(COUNTRY_TOP_10_FILENAME, na = c("", "NA", "N/A"))

```

Let's check to see if it worked:

```{r}

glimpse(COUNTRY_TOP_10)

```

## Initial Data Exploration

Before preparing our press releases, we're going to explore the data to understand what information is available. Since we're examining a new dataset, we will be looking at a random selection of rows rather than just the first few to increase our chances of spotting issues throughout the data.


Let's create an interactive table to explore the global Top 10 data. We'll use the `DT` package to make our tables more readable:

```{r}

library(DT)
GLOBAL_TOP_10 |> 
    head(n=20) |>
    datatable(options=list(searching=FALSE, info=FALSE))

```

This table has issues with column names not being formatted well and large numbers that are hard to read. Our next step will fix both:

```{r}

library(stringr)
format_titles <- function(df){
    colnames(df) <- str_replace_all(colnames(df), "_", " ") |> str_to_title()
    df
}

GLOBAL_TOP_10 |> 
    format_titles() |>
    head(n=20) |>
    datatable(options=list(searching=FALSE, info=FALSE)) |>
    formatRound(c('Weekly Hours Viewed', 'Weekly Views'))

```

That is much better! While we're at it though, we're going to remove the season_title since we are only showing films here.

```{r}

GLOBAL_TOP_10 |> 
    select(-season_title) |>
    format_titles() |>
    head(n=20) |>
    datatable(options=list(searching=FALSE, info=FALSE)) |>
    formatRound(c('Weekly Hours Viewed', 'Weekly Views'))

```
Next, we'll be converting run_time from hours to minutes for easier interpretation:

```{r}

GLOBAL_TOP_10 |> 
    mutate(`runtime_(minutes)` = round(60 * runtime)) |>
    select(-season_title, 
           -runtime) |>
    format_titles() |>
    head(n=20) |>
    datatable(options=list(searching=FALSE, info=FALSE)) |>
    formatRound(c('Weekly Hours Viewed', 'Weekly Views'))

```

## Exploratory Analysis

Here we'll be exploring the data by answering some questions about global reach and successful contnent.

1. How many different countries does Netflix operate in? (Using the viewing history as a proxy for countries in which Netflix operates.)

```{r}

num_countries <- COUNTRY_TOP_10 |>
  summarise(n_countries = n_distinct(country_name)) |>
  pull(n_countries)

# This prints the value.
num_countries 

```

Netflix operates in 94 different countries.

2. Which non-English-language film has spent the most cumulative weeks in the global top 10? How many weeks did it spend?

```{r}

top_non_english <- GLOBAL_TOP_10 |>
  filter(category == "Films (Non-English)") |>
  group_by(show_title) |>
  summarise(total_weeks = sum(cumulative_weeks_in_top_10)) |>
  arrange(desc(total_weeks)) |>
  slice(1)

film_name <- top_non_english$show_title
weeks_count <- top_non_english$total_weeks

# Print result
top_non_english

```
"All Quiet on the Western Front" is the non-English-language film that has spent the most cumulative weeks in the global top 10, with a total of 39 weeks.

3. What is the longest film (English or non-English) to have ever appeared in the Netflix global Top 10? How long is it in minutes?

```{r}

longest_film <- GLOBAL_TOP_10 |>
  filter(!is.na(runtime)) |>
  mutate(runtime_minutes = round(60 * runtime)) |>
  arrange(desc(runtime_minutes)) |>
  slice(1) |>
  select(show_title, runtime_minutes)

longest_film_name <- longest_film$show_title
longest_film_minutes <- longest_film$runtime_minutes

# Print result
longest_film

```
The longest film to have ever appeared in the Netflix global Top 10 is "Until You Burn" with a run time of 2855 minutes.

4. For each of the four categories, what program has the most total hours of global viewership?

```{r}

most_viewed_by_category <- GLOBAL_TOP_10 |>
  group_by(category, show_title) |>
  summarise(total_hours = sum(weekly_hours_viewed), .groups = "drop") |>
  group_by(category) |>
  slice_max(total_hours, n = 1) |>
  arrange(desc(total_hours))

# Print result
most_viewed_by_category |>
  format_titles() |>
  datatable(options = list(searching = FALSE, info = FALSE)) |>
  formatRound('Total Hours')

```
For each of the four categories, the programs with the most total hours of global viewership are: Squid Game (TV Non-English), Stranger Things (TV English), KPop Demon Hunters (Films English), and Society of the Snow (Films Non-English).

5. Which TV show had the longest run in a countryâ€™s Top 10? How long was this run and in what country did it occur?

```{r}

longest_country_run <- COUNTRY_TOP_10 |>
  filter(str_detect(category, "TV")) |>
  group_by(country_name, show_title) |>
  summarise(max_weeks = max(cumulative_weeks_in_top_10), .groups = "drop") |>
  arrange(desc(max_weeks)) |>
  slice(1)

show_name <- longest_country_run$show_title
run_weeks <- longest_country_run$max_weeks
country <- longest_country_run$country_name

# Print result
longest_country_run

```
The TV show with the longest run in a country's Top 10 is "Money Heist" in Pakistan, with a run of 127 weeks.

6. Netflix provides over 200 weeks of service history for all but one country in our data set. Which country is this and when did Netflix cease operations in that country?

```{r}

country_weeks <- COUNTRY_TOP_10 |>
  group_by(country_name) |>
  summarise(total_weeks = n_distinct(week)) |>
  arrange(total_weeks)

limited_country <- country_weeks |>
  filter(total_weeks < 200) |>
  slice(1)

# Get the last date Netflix operated there
last_date <- COUNTRY_TOP_10 |>
  filter(country_name == limited_country$country_name) |>
  summarise(last_week = max(week)) |>
  pull(last_week)

country_name <- limited_country$country_name
weeks_available <- limited_country$total_weeks

# Print result
limited_country
last_date

```
The country with less than 200 weeks of service history is Russia, with 35 weeks of data available. Netflix ceased operations there on February 27th, 2022.

7. What is the total viewership of the TV show Squid Game? Note that there are three seasons total and we are looking for the total number of hours watched across all seasons.

```{r}

squid_game_total <- GLOBAL_TOP_10 |>
  filter(show_title == "Squid Game") |>
  summarise(total_hours = sum(weekly_hours_viewed)) |>
  pull(total_hours)

# Print result
squid_game_total

```
The total viewership of the TV show Squid Game across all seasons is 5,048,300,000 hours.

8. The movie Red Notice has a runtime of 1 hour and 58 minutes. Approximately how many views did it receive in 2021? Note that Netflix does not provide the weekly_views values that far back in the past, but you can compute it yourself using the total view time and the runtime.

```{r}

library(lubridate)

red_notice_2021 <- GLOBAL_TOP_10 |>
  filter(show_title == "Red Notice", 
         year(week) == 2021) |>
  summarise(total_hours = sum(weekly_hours_viewed)) |>
  pull(total_hours)

# Runtime: 1 hour 58 minutes = 1.967 hours
runtime_hours <- 1 + 58/60
estimated_views <- round(red_notice_2021 / runtime_hours)

# Print result
estimated_views

```
In 2021, Red Notice received approximately 201,732,203 views.

9. How many Films reached Number 1 in the US but did not originally debut there? That is, find films that first appeared on the Top 10 chart at, e.g., Number 4 but then became more popular and eventually hit Number 1? What is the most recent film to pull this off?

```{r}

us_films <- COUNTRY_TOP_10 |>
  filter(country_iso2 == "US", category == "Films") |>
  group_by(show_title) |>
  mutate(ever_number_1 = any(weekly_rank == 1),
         debut_rank = first(weekly_rank)) |>
  filter(ever_number_1 == TRUE, debut_rank > 1) |>
  arrange(desc(week)) |>
  slice(1) |>
  select(show_title, week, debut_rank)

film_name <- us_films$show_title
recent_date <- us_films$week

# Print result
us_films

```
There are 27 films that reached Number 1 in the US but did not originally debut there. The most recent film to achieve this is "A Family Affair," which debuted at rank 3 on July 14th, 2024.

10. Which TV show/season hit the top 10 in the most countries in its debut week? In how many countries did it chart?

```{r}

widest_debut <- COUNTRY_TOP_10 |>
  filter(str_detect(category, "TV")) |>
  group_by(show_title, season_title) |>
  mutate(debut_week = min(week)) |>
  filter(week == debut_week) |>
  group_by(show_title, season_title) |>
  summarise(countries_count = n_distinct(country_name), .groups = "drop") |>
  arrange(desc(countries_count)) |>
  slice(1)

show_name <- widest_debut$show_title
season <- widest_debut$season_title
num_countries <- widest_debut$countries_count

# Print result
widest_debut

```
The TV show/season that hit the top 10 in the most countries in its debut week is "Emily in Paris" Season 2, which charted in 94 countries.

Up Next: Stranger Things Press Release

```{r}
# Gather Stranger Things data
stranger_things_data <- GLOBAL_TOP_10 |>
  filter(show_title == "Stranger Things") |>
  summarise(
    total_hours = sum(weekly_hours_viewed),
    total_weeks = sum(cumulative_weeks_in_top_10)
  )

# Country reach
st_countries <- COUNTRY_TOP_10 |>
  filter(show_title == "Stranger Things") |>
  summarise(countries = n_distinct(country_name))

# Compare to other English TV shows
top_english_tv <- GLOBAL_TOP_10 |>
  filter(category == "TV (English)") |>
  group_by(show_title) |>
  summarise(total_hours = sum(weekly_hours_viewed)) |>
  arrange(desc(total_hours)) |>
  head(5)

stranger_things_data
st_countries
top_english_tv

```

### Stranger Things: The Phenomenon That Captivated the World Returns for Its Epic Finale

**FOR IMMEDIATE RELEASE**

As Netflix prepares to release the fifth and final season of *Stranger Things* in late 2025, the series stands as the most-watched English-language TV show in Netflix history. Across its first four seasons, *Stranger Things* has captivated audiences with a whopping 2.97 billion viewing hours, surpassing other Netflix hits like *Wednesday* (2.88 billion hours) and *Bridgerton* (2.28 billion hours). The show's unprecedented popularity has continued for 366 cumulative weeks in the Netflix Top 10, demonstrating remarkable staying power with global audiences. With a presence in 93 countries worldwide, *Stranger Things* has transcended cultural boundaries to become a truly international phenomenon.

